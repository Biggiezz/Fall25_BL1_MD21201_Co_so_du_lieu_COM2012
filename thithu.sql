CREATE DATABASE ONTAP;

USE ONTAP;

CREATE TABLE LOPHOC(
MALOP VARCHAR(50) NOT NULL PRIMARY KEY,
TENLOP VARCHAR(50) NOT NULL,
GIANGVIEN NVARCHAR(50) NOT NULL,
NGAYBATDAU DATE,
NGAYKETTHUC DATE
);

INSERT INTO LOPHOC(MALOP, TENLOP ,GIANGVIEN , NGAYBATDAU, NGAYKETTHUC) VALUES
('LOP001','LOP A1',N'NGUYỄN ĐÌNH HUY','2025-05-03','2026-06-30'),
('LOP002','LOP A2',N'TRẦN MẠNH PHÚC','2025-05-12','2026-07-30'),
('LOP003','LOP A3',N'BÙI ĐỨC MẠNH','2025-05-10','2026-04-30');

CREATE TABLE SINHVIEN(
MASV VARCHAR(50) NOT NULL PRIMARY KEY,
TENSV NVARCHAR(50) NOT NULL,
NGAYSINH DATE,
SDT VARCHAR(50),
EMAIL VARCHAR(50)
);

INSERT INTO SINHVIEN(MASV, TENSV, NGAYSINH , SDT, EMAIL) VALUES
('SV01',N'NGUYỄN MẠNH PHÚC','2001-10-05','0943718195','manhphuc3005@gmail.com'),
('SV02',N'BÙI THẾ HUY','1993-12-12','0343715125','cilylov3@gmail.com'),
('SV03',N'TRẦN BÌNH MINH','1996-06-10','02343725125','tuongmeocpqn@gmail.com');


DROP TABLE CHITIETSV;

CREATE TABLE CHITIETSV(
MALOP VARCHAR(50) NOT NULL,
MASV VARCHAR(50) NOT NULL,
DIEM FLOAT,
FOREIGN KEY (MALOP) REFERENCES LOPHOC(MALOP),
FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV),
PRIMARY KEY (MALOP, MASV)
);

INSERT INTO CHITIETSV(MALOP, MASV ,DIEM) VALUES
('LOP001','SV01',9.5),
('LOP003','SV03',7.8);

INSERT INTO CHITIETSV(MALOP, MASV ,DIEM) VALUES
('LOP002','SV02',3.5);

SELECT TENLOP, GIANGVIEN
FROM LOPHOC;

SELECT *FROM CHITIETSV;

UPDATE CHITIETSV
SET DIEM = 9.0
WHERE MASV = 'SV01';

DELETE FROM CHITIETSV
WHERE MASV = 'SV02';

SELECT *FROM SINHVIEN;

SELECT MALOP, MASV, DIEM
FROM CHITETSV
GROUP BY MALOP, MASV, DIEM
ORDER BY DIEM DESC LIMIT 1;

SELECT MALOP, MASV,
AVG(DIEM) AS DiemTrungBinh
FROM CHITIETSV
GROUP BY MALOP ,MASV
HAVING AVG(DIEM) >= 8;

